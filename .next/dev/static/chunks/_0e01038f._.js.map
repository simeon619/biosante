{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/aegonjs/Documents/sant%C3%A9-vitalit%C3%A9-store/services/api.ts"],"sourcesContent":["\nimport axios from 'axios';\nimport { CartItem, DeliveryEstimate } from '../types';\n\nconst API_URL = 'http://localhost:3333/api';\n\n/**\n * Payment initiation response\n */\ninterface PaymentInitResponse {\n    orderId: string;\n    checkoutUrl?: string; // Optional for cash on delivery\n    total: number;\n}\n\n\n/**\n * Payment verification response\n */\ninterface PaymentVerifyResponse {\n    status: 'success' | 'pending' | 'failed' | 'cancelled' | 'initiated';\n    order: {\n        id: string;\n        customerName: string;\n        total: number;\n        status: string;\n        items: CartItem[];\n    };\n}\n\nexport const api = {\n    /**\n     * Estimate delivery fee based on address and cart total\n     */\n    estimateDelivery: async (address: string, cartTotal: number): Promise<DeliveryEstimate | null> => {\n        try {\n            const response = await axios.post(`${API_URL}/deliveries/estimate`, {\n                address,\n                cartTotal\n            });\n            return response.data;\n        } catch (error) {\n            console.error('Error estimating delivery:', error);\n            return null;\n        }\n    },\n\n    /**\n     * Search for places\n     */\n    searchPlaces: async (query: string) => {\n        try {\n            const response = await axios.get(`${API_URL}/deliveries/search`, {\n                params: { query }\n            });\n            return response.data;\n        } catch (error) {\n            console.error('Error searching places:', error);\n            return [];\n        }\n    },\n\n    /**\n     * Create a delivery for a confirmed order\n     */\n    createDelivery: async (data: {\n        orderId: string;\n        address: string;\n        lat: number;\n        lon: number;\n        fee: number;\n        customerName: string;\n        customerPhone: string;\n        shippingCompany?: string;\n        shippingCity?: string;\n    }) => {\n        try {\n            const response = await axios.post(`${API_URL}/deliveries/create`, data);\n            return response.data;\n        } catch (error) {\n            console.error('Error creating delivery:', error);\n            throw error;\n        }\n    },\n\n    /**\n     * Initiate payment with Moneroo\n     * Creates order and returns checkout URL for redirect\n     */\n    initiatePayment: async (data: {\n        cart: CartItem[];\n        customer: {\n            name: string;\n            phone: string;\n            email?: string;\n        };\n        delivery: {\n            address: string;\n            lat: number;\n            lon: number;\n            fee: number;\n            addressNote?: string;\n            shippingCompany?: string;\n            shippingCity?: string;\n        };\n        paymentMethod?: 'online' | 'cash';\n        deliveryMode?: 'local' | 'shipping';\n    }): Promise<PaymentInitResponse> => {\n\n        const response = await axios.post(`${API_URL}/payments/initiate`, data);\n        return response.data;\n    },\n\n\n    /**\n     * Verify payment status\n     * Called when customer returns from Moneroo checkout\n     */\n    verifyPayment: async (paymentId?: string, orderId?: string): Promise<PaymentVerifyResponse> => {\n        const params: Record<string, string> = {};\n        if (orderId) params.orderId = orderId;\n\n        const url = paymentId\n            ? `${API_URL}/payments/verify/${paymentId}`\n            : `${API_URL}/payments/verify`;\n\n        const response = await axios.get(url, { params });\n        return response.data;\n    }\n};\n\n"],"names":[],"mappings":";;;;AACA;;AAGA,MAAM,UAAU;AA0BT,MAAM,MAAM;IACf;;KAEC,GACD,kBAAkB,OAAO,SAAiB;QACtC,IAAI;YACA,MAAM,WAAW,MAAM,mJAAK,CAAC,IAAI,CAAC,GAAG,QAAQ,oBAAoB,CAAC,EAAE;gBAChE;gBACA;YACJ;YACA,OAAO,SAAS,IAAI;QACxB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,8BAA8B;YAC5C,OAAO;QACX;IACJ;IAEA;;KAEC,GACD,cAAc,OAAO;QACjB,IAAI;YACA,MAAM,WAAW,MAAM,mJAAK,CAAC,GAAG,CAAC,GAAG,QAAQ,kBAAkB,CAAC,EAAE;gBAC7D,QAAQ;oBAAE;gBAAM;YACpB;YACA,OAAO,SAAS,IAAI;QACxB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,2BAA2B;YACzC,OAAO,EAAE;QACb;IACJ;IAEA;;KAEC,GACD,gBAAgB,OAAO;QAWnB,IAAI;YACA,MAAM,WAAW,MAAM,mJAAK,CAAC,IAAI,CAAC,GAAG,QAAQ,kBAAkB,CAAC,EAAE;YAClE,OAAO,SAAS,IAAI;QACxB,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,4BAA4B;YAC1C,MAAM;QACV;IACJ;IAEA;;;KAGC,GACD,iBAAiB,OAAO;QAoBpB,MAAM,WAAW,MAAM,mJAAK,CAAC,IAAI,CAAC,GAAG,QAAQ,kBAAkB,CAAC,EAAE;QAClE,OAAO,SAAS,IAAI;IACxB;IAGA;;;KAGC,GACD,eAAe,OAAO,WAAoB;QACtC,MAAM,SAAiC,CAAC;QACxC,IAAI,SAAS,OAAO,OAAO,GAAG;QAE9B,MAAM,MAAM,YACN,GAAG,QAAQ,iBAAiB,EAAE,WAAW,GACzC,GAAG,QAAQ,gBAAgB,CAAC;QAElC,MAAM,WAAW,MAAM,mJAAK,CAAC,GAAG,CAAC,KAAK;YAAE;QAAO;QAC/C,OAAO,SAAS,IAAI;IACxB;AACJ"}},
    {"offset": {"line": 79, "column": 0}, "map": {"version":3,"sources":["file:///home/aegonjs/Documents/sant%C3%A9-vitalit%C3%A9-store/app/%28store%29/payment/verify/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport { useSearchParams } from 'next/navigation';\nimport { CheckCircle, XCircle, Clock, Loader2, ArrowLeft, MessageCircle } from 'lucide-react';\nimport { api } from '@/services/api';\n\ninterface OrderDetails {\n    id: string;\n    customerName: string;\n    total: number;\n    status: string;\n}\n\ntype PaymentStatus = 'loading' | 'success' | 'pending' | 'failed' | 'error';\n\nexport default function PaymentVerifyPage() {\n    const searchParams = useSearchParams();\n    const [status, setStatus] = useState<PaymentStatus>('loading');\n    const [order, setOrder] = useState<OrderDetails | null>(null);\n    const [errorMessage, setErrorMessage] = useState<string>('');\n\n    useEffect(() => {\n        const verifyPayment = async () => {\n            // Get paymentId from URL (Moneroo adds it) or orderId from our session\n            const paymentId = searchParams.get('paymentId');\n            const paymentStatus = searchParams.get('paymentStatus');\n            const orderId = searchParams.get('orderId') || sessionStorage.getItem('pendingOrderId');\n\n            if (!paymentId && !orderId) {\n                setStatus('error');\n                setErrorMessage('Aucune commande √† v√©rifier.');\n                return;\n            }\n\n            try {\n                const result = await api.verifyPayment(paymentId || undefined, orderId || undefined);\n                setOrder(result.order);\n\n                // Map Moneroo status to our display status\n                if (result.status === 'success') {\n                    setStatus('success');\n                    // Clear pending order from session\n                    sessionStorage.removeItem('pendingOrderId');\n                } else if (result.status === 'pending' || result.status === 'initiated') {\n                    setStatus('pending');\n                } else {\n                    setStatus('failed');\n                }\n            } catch (error: any) {\n                console.error('Payment verification error:', error);\n                setStatus('error');\n                setErrorMessage(error.response?.data?.message || 'Erreur lors de la v√©rification du paiement.');\n            }\n        };\n\n        verifyPayment();\n    }, [searchParams]);\n\n    const handleWhatsApp = () => {\n        const message = order\n            ? `Bonjour, je viens de passer la commande ${order.id} d'un montant de ${order.total.toLocaleString()} FCFA.`\n            : 'Bonjour, j\\'ai besoin d\\'aide avec ma commande.';\n        const url = `https://wa.me/2250143678397?text=${encodeURIComponent(message)}`;\n        window.open(url, '_blank');\n    };\n\n    const handleRetry = () => {\n        window.location.reload();\n    };\n\n    const handleHome = () => {\n        window.location.href = '/';\n    };\n\n    const renderContent = () => {\n        switch (status) {\n            case 'loading':\n                return (\n                    <div className=\"text-center\">\n                        <div className=\"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <Loader2 className=\"w-10 h-10 text-gray-600 animate-spin\" />\n                        </div>\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">V√©rification en cours...</h2>\n                        <p className=\"text-gray-600\">Nous v√©rifions le statut de votre paiement.</p>\n                    </div>\n                );\n\n            case 'success':\n                return (\n                    <div className=\"text-center\">\n                        <div className=\"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <CheckCircle className=\"w-10 h-10 text-green-600\" />\n                        </div>\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Paiement R√©ussi !</h2>\n                        <p className=\"text-gray-600 mb-2\">\n                            Merci {order?.customerName}. Votre commande a √©t√© confirm√©e.\n                        </p>\n                        {order && (\n                            <p className=\"text-lg font-semibold text-green-600 mb-6\">\n                                Total: {order.total.toLocaleString()} FCFA\n                            </p>\n                        )}\n                        <div className=\"space-y-3\">\n                            <button\n                                onClick={handleWhatsApp}\n                                className=\"w-full py-3 bg-[#25D366] text-white rounded-xl font-bold hover:bg-[#128C7E] flex items-center justify-center gap-2\"\n                            >\n                                <MessageCircle className=\"w-5 h-5\" />\n                                Suivre sur WhatsApp\n                            </button>\n                            <button\n                                onClick={handleHome}\n                                className=\"w-full py-3 border border-gray-300 rounded-xl font-bold text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2\"\n                            >\n                                <ArrowLeft className=\"w-5 h-5\" />\n                                Retour √† l'accueil\n                            </button>\n                        </div>\n                    </div>\n                );\n\n            case 'pending':\n                return (\n                    <div className=\"text-center\">\n                        <div className=\"w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <Clock className=\"w-10 h-10 text-yellow-600\" />\n                        </div>\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Paiement en attente</h2>\n                        <p className=\"text-gray-600 mb-6\">\n                            Votre paiement est en cours de traitement.\n                            <br />Veuillez valider la transaction sur votre t√©l√©phone (USSD).\n                        </p>\n                        <div className=\"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-6\">\n                            <p className=\"text-yellow-800 text-sm\">\n                                üí° <strong>Mobile Money:</strong> Composez le code USSD affich√© pour valider le paiement.\n                            </p>\n                        </div>\n                        <div className=\"space-y-3\">\n                            <button\n                                onClick={handleRetry}\n                                className=\"w-full py-3 bg-gray-900 text-white rounded-xl font-bold hover:bg-gray-800\"\n                            >\n                                Actualiser le statut\n                            </button>\n                            <button\n                                onClick={handleWhatsApp}\n                                className=\"w-full py-3 border border-gray-300 rounded-xl font-bold text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2\"\n                            >\n                                <MessageCircle className=\"w-5 h-5\" />\n                                Besoin d'aide ?\n                            </button>\n                        </div>\n                    </div>\n                );\n\n            case 'failed':\n            case 'error':\n                return (\n                    <div className=\"text-center\">\n                        <div className=\"w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n                            <XCircle className=\"w-10 h-10 text-red-600\" />\n                        </div>\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">\n                            {status === 'failed' ? 'Paiement √âchou√©' : 'Erreur'}\n                        </h2>\n                        <p className=\"text-gray-600 mb-6\">\n                            {errorMessage || 'Le paiement n\\'a pas pu √™tre effectu√©. Veuillez r√©essayer.'}\n                        </p>\n                        <div className=\"space-y-3\">\n                            <button\n                                onClick={handleHome}\n                                className=\"w-full py-3 bg-gray-900 text-white rounded-xl font-bold hover:bg-gray-800\"\n                            >\n                                R√©essayer\n                            </button>\n                            <button\n                                onClick={handleWhatsApp}\n                                className=\"w-full py-3 border border-gray-300 rounded-xl font-bold text-gray-700 hover:bg-gray-50 flex items-center justify-center gap-2\"\n                            >\n                                <MessageCircle className=\"w-5 h-5\" />\n                                Contacter le support\n                            </button>\n                        </div>\n                    </div>\n                );\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4\">\n            <div className=\"bg-white p-8 rounded-2xl shadow-xl max-w-md w-full\">\n                {renderContent()}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}