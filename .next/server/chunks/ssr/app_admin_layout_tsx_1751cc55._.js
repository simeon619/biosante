module.exports=[78170,a=>{"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=a.i(87924),D=a.i(72131),E=a.i(50944),F=a.i(38246),G=a.i(70106);let H=(0,G.default)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);var I=a.i(38784),J=a.i(4975),K=a.i(83497),L=a.i(10227);let M=(0,G.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var N=a.i(23312),O=a.i(20005),P=a.i(72692);let Q=(0,G.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var R=a.i(33441),S=a.i(11156),T=a.i(13749),U=a.i(50522),V=a.i(21161),W=(a,b,c)=>{if(!b.has(a))throw TypeError("Cannot "+c)},X=(a,b,c)=>(W(a,b,"read from private field"),c?c.call(a):b.get(a)),Y=(a,b,c)=>{if(b.has(a))throw TypeError("Cannot add the same private member more than once");b instanceof WeakSet?b.add(a):b.set(a,c)},Z=(a,b,c,d)=>(W(a,b,"write to private field"),d?d.call(a,c):b.set(a,c),c),$=(a,b,c)=>(W(a,b,"access private method"),c),_="connected",aa="reconnecting",ab=class{constructor(a){Y(this,b,void 0),Y(this,c,void 0),Y(this,d,void 0),Y(this,e,void 0),Y(this,f,new Set),Y(this,g,0),Z(this,d,a.channel),Z(this,b,a.httpClient),Z(this,c,a.hooks),Z(this,e,a.getEventSourceStatus)}get isCreated(){return 1===X(this,g)}get isDeleted(){return 2===X(this,g)}get handlerCount(){return X(this,f).size}$runHandler(a){for(let b of X(this,f))b(a)}async create(){if(!this.isCreated)return this.forceCreate()}async forceCreate(){if(X(this,e).call(this)!==_)return new Promise(a=>{setTimeout(()=>{a(this.create())},100)});let a=X(this,b).createRequest("/__transmit/subscribe",{channel:X(this,d)});X(this,c)?.beforeSubscribe(a);try{let e=await X(this,b).send(a);if(e.text(),!e.ok)return void X(this,c)?.onSubscribeFailed(e);Z(this,g,1),X(this,c)?.onSubscription(X(this,d))}catch(a){}}async delete(){if(this.isDeleted||!this.isCreated)return;let a=X(this,b).createRequest("/__transmit/unsubscribe",{channel:X(this,d)});X(this,c)?.beforeUnsubscribe(a);try{let e=await X(this,b).send(a);if(e.text(),!e.ok)return;Z(this,g,2),X(this,c)?.onUnsubscription(X(this,d))}catch(a){}}onMessage(a){return X(this,f).add(a),()=>{X(this,f).delete(a)}}onMessageOnce(a){let b=this.onMessage(c=>{a(c),b()})}};b=new WeakMap,c=new WeakMap,d=new WeakMap,e=new WeakMap,f=new WeakMap,g=new WeakMap;var ac=class{constructor(a){Y(this,i),Y(this,h,void 0),Z(this,h,a)}send(a){return fetch(a)}createRequest(a,b){return new Request(`${X(this,h).baseUrl}${a}`,{method:"POST",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":$(this,i,j).call(this)??""},body:JSON.stringify({uid:X(this,h).uid,...b}),credentials:"include"})}};h=new WeakMap,i=new WeakSet,j=function(){if("undefined"==typeof document)return null;let a=document.cookie.match(RegExp("(^|;\\s*)(XSRF-TOKEN)=([^;]*)"));return a?decodeURIComponent(a[3]):null};var ad="beforeSubscribe",ae="beforeUnsubscribe",af="onReconnectAttempt",ag="onReconnectFailed",ah="onSubscribeFailed",ai="onSubscription",aj="onUnsubscription",ak=class{constructor(){Y(this,k,new Map)}register(a,b){return X(this,k).has(a)||X(this,k).set(a,new Set),X(this,k).get(a)?.add(b),this}beforeSubscribe(a){return X(this,k).get(ad)?.forEach(b=>b(a)),this}beforeUnsubscribe(a){return X(this,k).get(ae)?.forEach(b=>b(a)),this}onReconnectAttempt(a){return X(this,k).get(af)?.forEach(b=>b(a)),this}onReconnectFailed(){return X(this,k).get(ag)?.forEach(a=>a()),this}onSubscribeFailed(a){return X(this,k).get(ah)?.forEach(b=>b(a)),this}onSubscription(a){return X(this,k).get(ai)?.forEach(b=>b(a)),this}onUnsubscription(a){return X(this,k).get(aj)?.forEach(b=>b(a)),this}};k=new WeakMap;var al=class{constructor(a){Y(this,u),Y(this,w),Y(this,y),Y(this,A),Y(this,l,void 0),Y(this,m,void 0),Y(this,n,new Map),Y(this,o,void 0),Y(this,p,void 0),Y(this,q,"initializing"),Y(this,r,void 0),Y(this,s,void 0),Y(this,t,0),void 0===a.uidGenerator&&(a.uidGenerator=()=>crypto.randomUUID()),void 0===a.eventSourceFactory&&(a.eventSourceFactory=(...a)=>new EventSource(...a)),void 0===a.eventTargetFactory&&(a.eventTargetFactory=()=>new EventTarget),void 0===a.httpClientFactory&&(a.httpClientFactory=(a,b)=>new ac({baseUrl:a,uid:b})),void 0===a.maxReconnectAttempts&&(a.maxReconnectAttempts=5),Z(this,l,a.uidGenerator()),Z(this,s,a.eventTargetFactory()),Z(this,p,new ak),Z(this,o,a.httpClientFactory(a.baseUrl,X(this,l))),a.beforeSubscribe&&X(this,p).register(ad,a.beforeSubscribe),a.beforeUnsubscribe&&X(this,p).register(ae,a.beforeUnsubscribe),a.onReconnectAttempt&&X(this,p).register(af,a.onReconnectAttempt),a.onReconnectFailed&&X(this,p).register(ag,a.onReconnectFailed),a.onSubscribeFailed&&X(this,p).register(ah,a.onSubscribeFailed),a.onSubscription&&X(this,p).register(ai,a.onSubscription),a.onUnsubscription&&X(this,p).register(aj,a.onUnsubscription),Z(this,m,a),$(this,w,x).call(this)}get uid(){return X(this,l)}subscription(a){let b=new ab({channel:a,httpClient:X(this,o),hooks:X(this,p),getEventSourceStatus:()=>X(this,q)});return X(this,n).has(a)?X(this,n).get(a):(X(this,n).set(a,b),b)}on(a,b){X(this,s)?.addEventListener(a,b)}close(){X(this,r)?.close()}};l=new WeakMap,m=new WeakMap,n=new WeakMap,o=new WeakMap,p=new WeakMap,q=new WeakMap,r=new WeakMap,s=new WeakMap,t=new WeakMap,u=new WeakSet,v=function(a){Z(this,q,a),X(this,s)?.dispatchEvent(new CustomEvent(a))},w=new WeakSet,x=function(){$(this,u,v).call(this,"connecting");let a=new URL(`${X(this,m).baseUrl}/__transmit/events`);a.searchParams.append("uid",X(this,l)),Z(this,r,X(this,m).eventSourceFactory(a,{withCredentials:!0})),X(this,r).addEventListener("message",$(this,y,z).bind(this)),X(this,r).addEventListener("error",$(this,A,B).bind(this)),X(this,r).addEventListener("open",()=>{for(let a of($(this,u,v).call(this,_),Z(this,t,0),X(this,n).values()))a.isCreated&&a.forceCreate()})},y=new WeakSet,z=function(a){let b=JSON.parse(a.data),c=X(this,n).get(b.channel);if(void 0!==c)try{c.$runHandler(b.payload)}catch(a){console.log(a)}},A=new WeakSet,B=function(){let a,b;if(X(this,q)!==aa&&$(this,u,v).call(this,"disconnected"),$(this,u,v).call(this,aa),X(this,p).onReconnectAttempt(X(this,t)+1),X(this,m).maxReconnectAttempts&&X(this,t)>=X(this,m).maxReconnectAttempts){X(this,r).close(),X(this,p).onReconnectFailed();return}(a=this,b=t,{set _(value){Z(a,b,value,void 0)},get _(){return X(a,b,void 0)}})._++};var am=a.i(33508),an=a.i(52495);function ao({notification:a,onClose:b}){let[c,d]=(0,D.useState)(100);(0,D.useEffect)(()=>{let a=setInterval(()=>{d(c=>c<=0?(clearInterval(a),b(),0):c-2)},100);return()=>clearInterval(a)},[b]);let e={low:"bg-gray-500",normal:"bg-blue-500",high:"bg-orange-500",urgent:"bg-red-500"}[a.priority||"normal"];return(0,C.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl border border-gray-100 overflow-hidden w-80 animate-in slide-in-from-right duration-300",children:[(0,C.jsx)("div",{className:"p-4",children:(0,C.jsxs)("div",{className:"flex items-start gap-3",children:[(0,C.jsx)("div",{className:`${e} p-2 rounded-lg text-white`,children:(0,C.jsx)(N.Bell,{className:"w-5 h-5"})}),(0,C.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,C.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,C.jsx)("p",{className:"font-bold text-gray-900 truncate",children:a.title}),(0,C.jsx)("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,C.jsx)(am.X,{className:"w-4 h-4"})})]}),(0,C.jsx)("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:a.body}),a.data?.orderId&&(0,C.jsxs)(F.default,{href:`/admin/orders/${a.data.orderId}`,className:"mt-2 inline-flex items-center gap-1 text-xs font-semibold text-black hover:underline",onClick:b,children:["Voir la commande ",(0,C.jsx)(an.ExternalLink,{className:"w-3 h-3"})]})]})]})}),(0,C.jsx)("div",{className:"h-1 w-full bg-gray-100",children:(0,C.jsx)("div",{className:`${e} h-full transition-all duration-100 ease-linear`,style:{width:`${c}%`}})})]})}function ap({children:a}){let b=(0,E.useRouter)(),c=(0,E.usePathname)(),[d,e]=(0,D.useState)(!1),[f,g]=(0,D.useState)(!0),[h,i]=(0,D.useState)(!1),[j,k]=(0,D.useState)(!1),[l,m]=(0,D.useState)(""),[n,o]=(0,D.useState)(!1),{notifications:p,unreadCount:q,markAsRead:r}=function(){let[a,b]=(0,D.useState)([]),[c,d]=(0,D.useState)(0),e=(0,D.useCallback)(a=>{b(b=>[a,...b].slice(0,50)),d(a=>a+1),"Notification"in window&&"granted"===Notification.permission&&new Notification(a.title,{body:a.body,icon:"/logo.png"})},[]);return(0,D.useEffect)(()=>{let a=new al({baseUrl:"http://127.0.0.1:3333"}).subscription("admin_alerts");return a.onMessage(a=>{console.log("[Admin Notification Received]",a),e(a)}),(async()=>{try{await a.create(),console.log("[Admin WebSocket] Subscribed to admin_alerts")}catch(a){console.error("[Admin WebSocket] Subscription error:",a)}})(),"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission(),()=>{a.delete()}},[e]),{notifications:a,unreadCount:c,markAsRead:()=>{d(0)}}}(),[s,t]=(0,D.useState)([]);(0,D.useEffect)(()=>{if(p.length>0){let a={id:Date.now(),notification:p[0]};t(b=>[...b,a])}},[p]),(0,D.useEffect)(()=>{let a=localStorage.getItem("admin_sidebar_collapsed");a&&k("true"===a);let b=()=>{window.innerWidth<1280&&window.innerWidth>=1024&&k(!0)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),(0,D.useEffect)(()=>{let a=localStorage.getItem("admin_token"),d=localStorage.getItem("admin_data");a||"/admin/login"===c?(e(!0),d&&m(JSON.parse(d).name)):b.push("/admin/login"),g(!1)},[c,b]);let u=[{href:"/admin",label:"Dashboard",icon:H},{href:"/admin/orders",label:"Commandes",icon:I.ShoppingCart},{href:"/admin/audio",label:"Témoignages",icon:J.Mic},{href:"/admin/products",label:"Produits",icon:K.Package},{href:"/admin/shipping",label:"Expédition",icon:L.Truck},{href:"/admin/payments",label:"Paiements",icon:S.CreditCard},{href:"/admin/stats",label:"Statistiques",icon:M},{href:"/admin/settings",label:"Paramètres",icon:V.Settings},{href:"/admin/dlq",label:"DLQ",icon:Q}];return f?(0,C.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,C.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-black"})}):"/admin/login"===c?(0,C.jsx)(C.Fragment,{children:a}):d?(0,C.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,C.jsx)("div",{className:"fixed top-20 right-6 z-[100] flex flex-col gap-4 pointer-events-none",children:s.map(a=>(0,C.jsx)("div",{className:"pointer-events-auto",children:(0,C.jsx)(ao,{notification:a.notification,onClose:()=>{var b;return b=a.id,void t(a=>a.filter(a=>a.id!==b))}})},a.id))}),h&&(0,C.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>i(!1)}),(0,C.jsx)("aside",{className:`fixed top-0 left-0 z-50 h-full bg-black text-white transform transition-all duration-300 ease-in-out
                ${h?"translate-x-0":"-translate-x-full lg:translate-x-0"}
                ${j?"lg:w-20":"lg:w-64"}
                w-64
            `,children:(0,C.jsxs)("div",{className:"flex flex-col h-full",children:[(0,C.jsxs)("div",{className:`p-4 border-b border-white/10 flex items-center ${j?"lg:justify-center":"justify-between"}`,children:[(0,C.jsxs)("div",{className:`${j?"lg:hidden":""}`,children:[(0,C.jsx)("h1",{className:"text-xl font-bold",children:"Santé Vitalité"}),(0,C.jsx)("p",{className:"text-xs text-white/50 mt-0.5",children:"Administration"})]}),j&&(0,C.jsx)("div",{className:"hidden lg:block",children:(0,C.jsx)("span",{className:"text-2xl font-black",children:"SV"})}),(0,C.jsx)("button",{onClick:()=>{let a=!j;k(a),localStorage.setItem("admin_sidebar_collapsed",String(a))},className:"hidden lg:flex w-8 h-8 items-center justify-center rounded-lg hover:bg-white/10 transition-colors",title:j?"Déplier":"Replier",children:j?(0,C.jsx)(U.ChevronRight,{className:"w-5 h-5"}):(0,C.jsx)(T.ChevronLeft,{className:"w-5 h-5"})})]}),(0,C.jsx)("nav",{className:"flex-1 p-2 space-y-1 overflow-y-auto",children:u.map(a=>{let b=a.icon,d=c===a.href||"/admin"!==a.href&&c.startsWith(a.href);return(0,C.jsxs)(F.default,{href:a.href,onClick:()=>i(!1),className:`flex items-center gap-3 px-3 py-3 rounded-lg transition-colors relative group
                                        ${d?"bg-white text-black":"text-white/70 hover:bg-white/10 hover:text-white"}
                                        ${j?"lg:justify-center lg:px-0":""}
                                    `,title:j?a.label:void 0,children:[(0,C.jsx)(b,{className:"w-5 h-5 flex-shrink-0"}),(0,C.jsx)("span",{className:`font-medium ${j?"lg:hidden":""}`,children:a.label}),j&&(0,C.jsx)("div",{className:"absolute left-full ml-2 px-2 py-1 bg-gray-900 text-white text-sm rounded-md whitespace-nowrap opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50 hidden lg:block",children:a.label})]},a.href)})}),(0,C.jsxs)("div",{className:`p-3 border-t border-white/10 ${j?"lg:px-2":""}`,children:[(0,C.jsxs)("div",{className:`flex items-center gap-3 mb-3 ${j?"lg:justify-center":""}`,children:[(0,C.jsx)("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0",children:(0,C.jsx)("span",{className:"text-lg font-bold",children:l.charAt(0)})}),(0,C.jsxs)("div",{className:`${j?"lg:hidden":""}`,children:[(0,C.jsx)("p",{className:"font-medium text-sm text-white truncate",children:l}),(0,C.jsx)("p",{className:"text-xs text-white/50",children:"Administrateur"})]})]}),(0,C.jsxs)("button",{onClick:()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_data"),b.push("/admin/login")},className:`flex items-center gap-2 w-full px-3 py-2 text-sm text-red-400 hover:bg-red-500/10 rounded-lg transition-colors ${j?"lg:justify-center lg:px-0":""}`,title:j?"Déconnexion":void 0,children:[(0,C.jsx)(O.LogOut,{className:"w-4 h-4 flex-shrink-0"}),(0,C.jsx)("span",{className:`${j?"lg:hidden":""}`,children:"Déconnexion"})]})]})]})}),(0,C.jsxs)("div",{className:`transition-all duration-300 ${j?"lg:pl-20":"lg:pl-64"}`,children:[(0,C.jsxs)("header",{className:"bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between sticky top-0 z-30",children:[(0,C.jsx)("button",{className:"lg:hidden p-2 rounded-lg hover:bg-gray-100",onClick:()=>i(!0),children:(0,C.jsx)(P.Menu,{className:"w-6 h-6"})}),(0,C.jsx)("div",{className:"flex items-center gap-4 ml-auto",children:(0,C.jsxs)("div",{className:"relative",children:[(0,C.jsxs)("button",{onClick:()=>{o(!n),n||r()},className:"relative p-2 rounded-full hover:bg-gray-100 transition-colors",children:[(0,C.jsx)(N.Bell,{className:"w-5 h-5"}),q>0&&(0,C.jsx)("span",{className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white text-[10px] font-bold flex items-center justify-center rounded-full border-2 border-white animate-pulse",children:q>9?"9+":q})]}),n&&(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),(0,C.jsxs)("div",{className:"absolute right-0 mt-3 w-80 bg-white rounded-2xl shadow-2xl border border-gray-100 z-50 overflow-hidden",children:[(0,C.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center justify-between",children:[(0,C.jsx)("h3",{className:"font-bold text-gray-900",children:"Notifications"}),(0,C.jsxs)("button",{onClick:r,className:"text-xs text-gray-500 hover:text-black flex items-center gap-1",children:[(0,C.jsx)(R.Check,{className:"w-3 h-3"})," Tout marquer comme lu"]})]}),(0,C.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:0===p.length?(0,C.jsxs)("div",{className:"p-8 text-center text-gray-400",children:[(0,C.jsx)(N.Bell,{className:"w-8 h-8 mx-auto mb-2 opacity-20"}),(0,C.jsx)("p",{className:"text-sm",children:"Aucune notification"})]}):p.map((a,b)=>(0,C.jsxs)("div",{className:"p-4 border-b border-gray-50 hover:bg-gray-50 transition-colors",children:[(0,C.jsx)("p",{className:"text-sm font-bold text-gray-900",children:a.title}),(0,C.jsx)("p",{className:"text-xs text-gray-600 mt-0.5",children:a.body}),(0,C.jsx)("p",{className:"text-[10px] text-gray-400 mt-2",children:new Date(a.timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})})]},b))}),(0,C.jsx)("div",{className:"p-3 bg-gray-50 text-center",children:(0,C.jsx)(F.default,{href:"/admin/notifications",className:"text-xs font-semibold text-gray-600 hover:text-black",onClick:()=>o(!1),children:"Voir tout l'historique"})})]})]})]})})]}),(0,C.jsx)("main",{className:"p-6",children:a})]})]}):null}a.s(["default",()=>ap],78170)}];

//# sourceMappingURL=app_admin_layout_tsx_1751cc55._.js.map